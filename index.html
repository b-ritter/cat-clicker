<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Cat Clicker: Dual</title>
</head>
<body>
  <div id="catContainer">
  </div>

  <template id="catTemplate" type="text/template">
    <div class="cat">
      <div class="catName">{{name}}</div>
      <img src="http://lorempixel.com/400/300/cats/">
      <div class="clickDisplay">
      </div>
    </div>
  </template>

  <script>
    // Our cat data model
    
    var catUrl = 'http://lorempixel.com/400/300/cats/';
    // TODO: build loop to generate data
    var cats = [
      {
        'name': 'Grimes',
        'url': catUrl,
        'clicks': 0
      },{
        'name': 'Ludwig',
        'url': catUrl,
        'clicks': 0
      }
    ];

    // Cat Controller
    var catController = {
      setClicks: function(cat, clicks){
        cat.clicks = clicks;
      },
      getClicks: function(cat){
        return cat.clicks;
      },
      setName: function(cat, name) {
        cat.name = name;
      },
      getName: function(){

      },
      getCats: function(){
        return cats;
      }
    };

    // Cat view
    var catView = {
      init: function(){
        var catContainer = document.getElementById('catContainer');
        var catTemplate = document.getElementById('catTemplate');
        this.loadTemplate();
        this.bindData();
      },
      loadTemplate: function() {
        var cats = catController.getCats();
        var numCats = cats.length;
        var c = catTemplate.content;
        var elem;
        for(var i = 0; i < numCats; i++){
          elem = document.importNode(c, true);
          catContainer.appendChild(elem);
        }
      },
      // TODO: Separate out a function to wrap closures around elements
      // from the rendering of data
      bindData: function(){
        var kitties = document.getElementsByClassName('cat');
        var self = this;
        for (var k = 0, numKitties = kitties.length; k < numKitties; k++){
          // TODO: Review closures
          (function(catObj, k){
            catObj.name = cats[k].name;
            catObj.clicks = cats[k].clicks;
            catObj.querySelector('.catName').innerHTML = catObj.name;
            catObj.querySelector('.clickDisplay').innerHTML = catObj.clicks;
            catObj.addEventListener('click',function(){
              catObj.clicks++;
              catObj.querySelector('.clickDisplay').innerHTML = catObj.clicks;
            });
          })(kitties[k],k);
        }
      },
      render: function() {
      }
    };

    catView.init();

  </script>
</body>
</html>
