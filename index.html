<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Cat Clicker: Dual</title>
</head>
<body>
  <div id="catContainer">
  </div>

  <template id="catTemplate" type="text/template">
    <div class="cat">
      <div class="catName">{{name}}</div>
      <img src="http://lorempixel.com/400/300/cats/">
      <div class="clickDisplay">
      </div>
    </div>
  </template>

  <script>
    // Our cat data model
    var catUrl = 'http://lorempixel.com/400/300/cats/';
    var cats = [
      {
        'name': 'Grimes',
        'url': catUrl,
        'clicks': 0
      },{
        'name': 'Ludwig',
        'url': catUrl,
        'clicks': 0
      }
    ];

    // Cat Controller
    var catController = {
      setClicks: function(){

      },
      getClicks: function(){

      },
      getName: function(){

      },
      getCats: function(){
        return cats;
      },
      update: function(cat) {
        for(var c = 0; c < cats.length; c++){
        }
      }
    };

    // Cat view
    var catView = {
      init: function(){
        var catContainer = document.getElementById('catContainer');
        var catTemplate = document.getElementById('catTemplate');
        this.render();
        // Now that the DOM elements are 'activated', bind event listeners
        this.attachClickHandlers();
      },
      render: function() {
        var cats = catController.getCats();
        var numCats = cats.length;
        var c = catTemplate.content;
        var elem;
        for(var i = 0; i < numCats; i++){
          elem = document.importNode(c, true);
          catContainer.appendChild(elem);
        }
      },
      // TODO: Separate out a function to wrap closures around elements
      // from the rendering of data
      attachClickHandlers: function(){
        var kitties = document.getElementsByClassName('cat');
        var numKitties = kitties.length;
        for( k = 0; k < numKitties; k++){
          // TODO: Review closures
          (function(catObj, k){
            catObj.name = cats[k].name;
            catObj.querySelector('.catName').innerHTML = cats[k].name;
            catObj.querySelector('.clickDisplay').innerHTML = cats[k].clicks;
            catObj.clicks = cats[k].clicks;
            catObj.addEventListener('click',function(){
              catObj.clicks++;
              catObj.querySelector('.clickDisplay').innerHTML = catObj.clicks;
            });
          })(kitties[k],k);
        }
      }
    };

    catView.init();

  </script>
</body>
</html>
