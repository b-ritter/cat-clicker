<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Cat Clicker: Dual</title>
</head>
<body>
  <div id="catContainer">
  </div>

  <template id="catTemplate" type="text/template">
    <div class="cat">
      <div class="catName">{{name}}</div>
      <img src="">
      <div class="clickDisplay">
      </div>
    </div>
  </template>

  <script>
    // Our cat data model
    var cats = [];
    var catNames = ['Ludwig', 'Grimes', 'Prince', 'Miles', 'Pete',
    'Wolfgang', 'Pierre', 'Pablo'];
    var catUrl = 'images/lorempixel-cxx.jpg';
    var imageIndexNum;
    for (var i = 0, numCats = catNames.length; i < numCats; i++){
      var newUrl = catUrl.split('xx');
      imageIndexNum = i + 1;
      newUrl.splice(1, 0, ( imageIndexNum < 10 ? ("0" + imageIndexNum) : imageIndexNum ) );
      cats.push({
        'name': catNames[i],
        'url': newUrl.join(''),
        'clicks': 0
      });
    }

    // Cat Controller
    var catController = {
      getCats: function(){
        return cats;
      }
    };

    // Cat view
    var catView = {
      'ks': [],
      init: function(){
        var catContainer = document.getElementById('catContainer');
        var catTemplate = document.getElementById('catTemplate');
        this.loadTemplate();
        this.bindData();
        console.log(this.ks);
      },
      loadTemplate: function() {
        var cats = catController.getCats();
        var numCats = cats.length;
        var c = catTemplate.content;
        var elem;
        for(var i = 0; i < numCats; i++){
          elem = document.importNode(c, true);
          catContainer.appendChild(elem);
        }
      },
      // TODO: Separate out a function to wrap closures around elements
      // from the rendering of data
      bindData: function(){
        var kitties = document.getElementsByClassName('cat');
        var self = this;
        for (var k = 0, numKitties = kitties.length; k < numKitties; k++){
          // TODO: Review closures
          (function(catObj, k){
            catObj.name = cats[k].name;
            catObj.clicks = cats[k].clicks;
            catObj.url = cats[k].url;
            // How do we separate the view from the data binding?
            catObj.querySelector('.catName').innerHTML = catObj.name;
            var url = catObj.getElementsByTagName('img');
            url[0].setAttribute('src', catObj.url);
            catObj.querySelector('.clickDisplay').innerHTML = catObj.clicks;
            catObj.addEventListener('click',function(){
              catObj.clicks++;
              catObj.querySelector('.clickDisplay').innerHTML = catObj.clicks;
            });
            self.ks.push(catObj);
          })(kitties[k],k);
        }
      }
      /* TODO: Add render function. How do we access the objects we made in bindData?
      ,
      render: function() {
      }
      */
    };

    catView.init();

  </script>
</body>
</html>
